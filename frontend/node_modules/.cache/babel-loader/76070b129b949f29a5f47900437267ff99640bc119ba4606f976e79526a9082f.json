{"ast":null,"code":"import _objectSpread from\"C:/Users/kuben/OneDrive/Desktop/PERSONALIZED LEARNING COPILOT FOR CORE COURSES/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import{useNavigate}from'react-router-dom';import{FiTarget,FiClock,FiZap,FiSun,FiPlay,FiPause,FiX,FiBell,FiCheck,FiEdit2}from'react-icons/fi';import{analyticsAPI}from'../services/api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";export const PersonalizedInsights=()=>{const navigate=useNavigate();const[insights,setInsights]=useState(null);const[loading,setLoading]=useState(true);const[timer,setTimer]=useState({active:false,topic:'',elapsedSeconds:0});const[showTimerModal,setShowTimerModal]=useState(false);const[showFocusTimeModal,setShowFocusTimeModal]=useState(false);const[selectedStartHour,setSelectedStartHour]=useState(9);const[selectedEndHour,setSelectedEndHour]=useState(11);const[selectedTopic,setSelectedTopic]=useState('trees');const[reminderSet,setReminderSet]=useState(false);const[showReminderToast,setShowReminderToast]=useState(false);// Fetch insights data\nconst fetchInsights=useCallback(async()=>{try{const response=await analyticsAPI.getInsights();setInsights(response.data);}catch(error){console.error('Failed to fetch insights:',error);}finally{setLoading(false);}},[]);// Check timer status on mount\nconst checkTimerStatus=useCallback(async()=>{try{const response=await analyticsAPI.getTimerStatus();if(response.data.active){setTimer({active:true,topic:response.data.topic,elapsedSeconds:response.data.elapsedSeconds,startTime:new Date(response.data.startTime)});}}catch(error){console.error('Failed to check timer:',error);}},[]);useEffect(()=>{fetchInsights();checkTimerStatus();},[fetchInsights,checkTimerStatus]);// Timer tick effect\nuseEffect(()=>{let interval;if(timer.active){interval=setInterval(()=>{setTimer(prev=>_objectSpread(_objectSpread({},prev),{},{elapsedSeconds:prev.elapsedSeconds+1}));},1000);}return()=>clearInterval(interval);},[timer.active]);// Format time display\nconst formatTime=seconds=>{const mins=Math.floor(seconds/60);const secs=seconds%60;return\"\".concat(mins.toString().padStart(2,'0'),\":\").concat(secs.toString().padStart(2,'0'));};// Start timer\nconst handleStartTimer=async()=>{try{await analyticsAPI.startTimer(selectedTopic,'dsa');setTimer({active:true,topic:selectedTopic,elapsedSeconds:0,startTime:new Date()});setShowTimerModal(false);}catch(error){var _error$response,_error$response$data;console.error('Failed to start timer:',error);if(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)==='Timer already running'){alert('A timer is already running!');}}};// Stop timer\nconst handleStopTimer=async()=>{try{const focusScore=Math.min(100,70+Math.floor(timer.elapsedSeconds/60));const response=await analyticsAPI.stopTimer(75,focusScore);setTimer({active:false,topic:'',elapsedSeconds:0});// Refresh insights to show updated mastery\nfetchInsights();alert(\"Session completed! You studied \".concat(selectedTopic,\" for \").concat(Math.floor(response.data.duration),\" minutes. Mastery increased by \").concat(response.data.masteryIncrease,\"%!\"));}catch(error){console.error('Failed to stop timer:',error);}};// Handle practice click - navigate to chat with topic\nconst handlePractice=()=>{if(insights!==null&&insights!==void 0&&insights.weakestTopic){navigate(\"/chat/dsa?topic=\".concat(insights.weakestTopic.name.toLowerCase()));}};// Handle set reminder\nconst handleSetReminder=()=>{if('Notification'in window){Notification.requestPermission().then(permission=>{if(permission==='granted'){setReminderSet(true);setShowReminderToast(true);setTimeout(()=>setShowReminderToast(false),3000);// Schedule notification for next optimal time (demo: 10 seconds)\nsetTimeout(()=>{new Notification('ðŸ“š Study Time!',{body:\"It's your peak focus time (\".concat(insights===null||insights===void 0?void 0:insights.peakFocusTime.range,\"). Start learning now!\"),icon:'/favicon.ico'});},10000);}});}};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-200 animate-pulse rounded-xl h-24\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-200 animate-pulse rounded-xl h-24\"}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-200 animate-pulse rounded-xl h-24\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[showReminderToast&&/*#__PURE__*/_jsxs(\"div\",{className:\"fixed top-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 z-50 animate-slide-in\",children:[/*#__PURE__*/_jsx(FiCheck,{}),\" Reminder set for \",insights===null||insights===void 0?void 0:insights.peakFocusTime.range,\"!\"]}),timer.active&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-4 text-white animate-pulse-slow\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-white/20 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(FiClock,{className:\"text-2xl\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm opacity-80\",children:\"Currently Studying\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-bold capitalize\",children:timer.topic})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-4xl font-mono font-bold\",children:formatTime(timer.elapsedSeconds)}),/*#__PURE__*/_jsx(\"button\",{onClick:handleStopTimer,className:\"bg-white/20 hover:bg-white/30 p-3 rounded-full transition-colors\",children:/*#__PURE__*/_jsx(FiPause,{className:\"text-xl\"})})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-orange-50 to-amber-50 border border-orange-200 rounded-xl p-4 hover:shadow-md transition-all duration-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-orange-500 w-12 h-12 rounded-xl flex items-center justify-center text-white flex-shrink-0 shadow-lg\",children:/*#__PURE__*/_jsx(FiTarget,{className:\"text-xl\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between gap-2\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-bold text-gray-900\",children:[\"Focus on \",insights===null||insights===void 0?void 0:insights.weakestTopic.name,\" (Lowest Mastery)\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right flex-shrink-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-lg font-bold text-gray-900\",children:[insights===null||insights===void 0?void 0:insights.weakestTopic.mastery,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Mastery\"})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 text-sm mt-1\",children:[insights===null||insights===void 0?void 0:insights.weakestTopic.name,\" is your weakest area. Dedicate more time to mastering concepts like binary trees, BST, and traversals.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"h-2 bg-gray-200 rounded-full overflow-hidden\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-full bg-gradient-to-r from-orange-400 to-orange-600 rounded-full transition-all duration-1000\",style:{width:\"\".concat((insights===null||insights===void 0?void 0:insights.weakestTopic.mastery)||35,\"%\")}})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-xs text-gray-500 mt-1\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Current\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Goal: \",insights===null||insights===void 0?void 0:insights.weakestTopic.goal,\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handlePractice,className:\"mt-3 text-sm font-medium text-orange-600 hover:text-orange-800 transition-colors hover:underline flex items-center gap-1\",children:[/*#__PURE__*/_jsx(FiPlay,{className:\"text-xs\"}),\" Practice \",insights===null||insights===void 0?void 0:insights.weakestTopic.name,\" \\u2192\"]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-xl p-4 hover:shadow-md transition-all duration-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-green-500 w-12 h-12 rounded-xl flex items-center justify-center text-white flex-shrink-0 shadow-lg\",children:/*#__PURE__*/_jsx(FiSun,{className:\"text-xl\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between gap-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-bold text-gray-900\",children:[\"Peak Focus: \",insights===null||insights===void 0?void 0:insights.peakFocusTime.range]}),(insights===null||insights===void 0?void 0:insights.peakFocusTime.isCustom)&&/*#__PURE__*/_jsx(\"span\",{className:\"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full\",children:\"Custom\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right flex-shrink-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-900\",children:insights===null||insights===void 0?void 0:insights.peakFocusTime.range}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Best Study Time\"})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 text-sm mt-1\",children:[\"Your focus score is \",insights===null||insights===void 0?void 0:insights.peakFocusTime.score,\"% during these hours. Schedule important learning sessions then for maximum retention.\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4 mt-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>{setSelectedStartHour((insights===null||insights===void 0?void 0:insights.peakFocusTime.startHour)||9);setSelectedEndHour((insights===null||insights===void 0?void 0:insights.peakFocusTime.endHour)||11);setShowFocusTimeModal(true);},className:\"text-sm font-medium text-green-600 hover:text-green-800 transition-colors hover:underline flex items-center gap-1\",children:[/*#__PURE__*/_jsx(FiEdit2,{className:\"text-xs\"}),\" \",insights!==null&&insights!==void 0&&insights.peakFocusTime.isCustom?'Change Time':'Set Your Time',\" \\u2192\"]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSetReminder,disabled:reminderSet,className:\"text-sm font-medium transition-colors flex items-center gap-1 \".concat(reminderSet?'text-green-600 cursor-default':'text-green-600 hover:text-green-800 hover:underline'),children:reminderSet?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FiCheck,{className:\"text-xs\"}),\" Reminder Set!\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(FiBell,{className:\"text-xs\"}),\" Set Reminder \\u2192\"]})})]})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4 hover:shadow-md transition-all duration-200\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"bg-blue-500 w-12 h-12 rounded-xl flex items-center justify-center text-white flex-shrink-0 shadow-lg\",children:/*#__PURE__*/_jsx(FiClock,{className:\"text-xl\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 min-w-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between gap-2\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"font-bold text-gray-900\",children:[insights===null||insights===void 0?void 0:insights.optimalDuration.value,\" Sessions Work Best\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right flex-shrink-0\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-bold text-gray-900\",children:insights===null||insights===void 0?void 0:insights.optimalDuration.value}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:\"Optimal Duration\"})]})]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 text-sm mt-1\",children:[\"Shorter, focused sessions work better for your learning style (avg \",insights===null||insights===void 0?void 0:insights.optimalDuration.avgAccuracy,\"% accuracy). Take 5-minute breaks between sessions.\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setShowTimerModal(true),disabled:timer.active,className:\"mt-3 text-sm font-medium transition-colors flex items-center gap-1 \".concat(timer.active?'text-gray-400 cursor-not-allowed':'text-blue-600 hover:text-blue-800 hover:underline'),children:[/*#__PURE__*/_jsx(FiPlay,{className:\"text-xs\"}),\" \",timer.active?'Timer Running...':'Start Timer â†’']})]})]})})]}),showTimerModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 w-full max-w-md mx-4 animate-scale-in\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-900\",children:\"Start Study Session\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowTimerModal(false),className:\"p-2 hover:bg-gray-100 rounded-full\",children:/*#__PURE__*/_jsx(FiX,{})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Select Topic to Study\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedTopic,onChange:e=>setSelectedTopic(e.target.value),className:\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500\",children:insights===null||insights===void 0?void 0:insights.masteryByTopic.map((topic,idx)=>/*#__PURE__*/_jsxs(\"option\",{value:topic.topic.toLowerCase().replace(' ','-'),children:[topic.topic,\" (\",topic.mastery,\"% mastery)\"]},idx))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-blue-50 rounded-lg p-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-blue-700\",children:[/*#__PURE__*/_jsx(FiZap,{}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium\",children:[\"Recommended: \",insights===null||insights===void 0?void 0:insights.optimalDuration.value,\" session\"]})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-blue-600 mt-1\",children:\"Based on your learning patterns, shorter sessions with breaks work best for you.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowTimerModal(false),className:\"flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleStartTimer,className:\"flex-1 px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center justify-center gap-2\",children:[/*#__PURE__*/_jsx(FiPlay,{}),\" Start Timer\"]})]})]})}),showFocusTimeModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-2xl p-6 w-full max-w-md mx-4 animate-scale-in\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-xl font-bold text-gray-900\",children:\"Set Your Peak Focus Time\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowFocusTimeModal(false),className:\"p-2 hover:bg-gray-100 rounded-full\",children:/*#__PURE__*/_jsx(FiX,{})})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm mb-4\",children:\"Choose the time when you feel most focused and productive. We'll remind you to study during these hours.\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"Start Time\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedStartHour,onChange:e=>setSelectedStartHour(parseInt(e.target.value)),className:\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500\",children:Array.from({length:24},(_,i)=>{const hour12=i%12||12;const ampm=i<12?'AM':'PM';return/*#__PURE__*/_jsxs(\"option\",{value:i,children:[hour12,\":00 \",ampm]},i);})})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-2\",children:\"End Time\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedEndHour,onChange:e=>setSelectedEndHour(parseInt(e.target.value)),className:\"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500\",children:Array.from({length:24},(_,i)=>{const hour12=i%12||12;const ampm=i<12?'AM':'PM';return/*#__PURE__*/_jsxs(\"option\",{value:i,children:[hour12,\":00 \",ampm]},i);})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-green-50 rounded-lg p-4 mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2 text-green-700\",children:[/*#__PURE__*/_jsx(FiSun,{}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium\",children:[\"Selected: \",selectedStartHour%12||12,\":00 \",selectedStartHour<12?'AM':'PM',\" - \",selectedEndHour%12||12,\":00 \",selectedEndHour<12?'AM':'PM']})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-green-600 mt-1\",children:selectedEndHour>selectedStartHour?\"\".concat(selectedEndHour-selectedStartHour,\" hour study window\"):'Please select an end time after start time'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3\",children:[(insights===null||insights===void 0?void 0:insights.peakFocusTime.isCustom)&&/*#__PURE__*/_jsx(\"button\",{onClick:async()=>{try{await analyticsAPI.clearFocusTime();setShowFocusTimeModal(false);fetchInsights();}catch(error){console.error('Failed to clear focus time:',error);}},className:\"px-4 py-3 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors\",children:\"Reset to Auto\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowFocusTimeModal(false),className:\"flex-1 px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors\",children:\"Cancel\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:async()=>{if(selectedEndHour<=selectedStartHour){alert('End time must be after start time');return;}try{await analyticsAPI.setFocusTime(selectedStartHour,selectedEndHour);setShowFocusTimeModal(false);setReminderSet(false);// Reset reminder when time changes\nfetchInsights();}catch(error){console.error('Failed to save focus time:',error);}},disabled:selectedEndHour<=selectedStartHour,className:\"flex-1 px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed\",children:[/*#__PURE__*/_jsx(FiCheck,{}),\" Save Time\"]})]})]})})]});};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}