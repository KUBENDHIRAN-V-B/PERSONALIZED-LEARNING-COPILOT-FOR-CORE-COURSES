{"ast":null,"code":"import React,{useState,useEffect,useRef,useCallback,memo}from'react';import{useParams,useNavigate}from'react-router-dom';import{FiSend,FiArrowLeft,FiCpu}from'react-icons/fi';import{chatAPI}from'../services/api';import{useFocusTimer}from'../useFocusTimer';import{FocusTimer}from'../components/FocusTimer';import{AIResponseBox}from'../components/AIResponseBox';import APIStatusIndicator from'../components/APIStatusIndicator';import{DistractionStop}from'../components/DistractionStop';// Typing indicator component\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TypingIndicator=()=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-1 p-3\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'0ms'}}),/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'150ms'}}),/*#__PURE__*/_jsx(\"span\",{className:\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\",style:{animationDelay:'300ms'}})]});const ChatPage=/*#__PURE__*/memo(()=>{const{courseId}=useParams();const navigate=useNavigate();const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[loading,setLoading]=useState(false);const[conversationId,setConversationId]=useState(undefined);const[isFocusMode,setIsFocusMode]=useState(false);const focusTimer=useFocusTimer();const messagesEndRef=useRef(null);const inputRef=useRef(null);const scrollToBottom=useCallback(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:'smooth'});},[]);useEffect(()=>{scrollToBottom();},[messages,scrollToBottom]);useEffect(()=>{var _inputRef$current;(_inputRef$current=inputRef.current)===null||_inputRef$current===void 0?void 0:_inputRef$current.focus();},[]);const handleSendMessage=useCallback(async e=>{e.preventDefault();const trimmedInput=input.trim();if(!trimmedInput||loading)return;setLoading(true);setInput('');try{const response=await chatAPI.sendMessage(courseId||'dsa',trimmedInput,conversationId);if(!conversationId&&response.data.conversationId){setConversationId(response.data.conversationId);}const newMessage={id:\"msg_\".concat(Date.now()),userMessage:trimmedInput,aiResponse:response.data.aiResponse,timestamp:new Date()};setMessages(prev=>[...prev,newMessage]);}catch(error){console.error('Failed to send message:',error);setMessages(prev=>[...prev,{id:\"error_\".concat(Date.now()),userMessage:trimmedInput,aiResponse:'Sorry, I encountered an error. Please try again.',timestamp:new Date()}]);}finally{var _inputRef$current2;setLoading(false);(_inputRef$current2=inputRef.current)===null||_inputRef$current2===void 0?void 0:_inputRef$current2.focus();}},[input,loading,courseId,conversationId]);const handleKeyDown=useCallback(e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSendMessage(e);}},[handleSendMessage]);const goBack=useCallback(()=>navigate('/dashboard'),[navigate]);const courseName=(courseId===null||courseId===void 0?void 0:courseId.toUpperCase())||'Learning';return/*#__PURE__*/_jsxs(\"div\",{className:\"h-screen flex flex-col transition-all duration-300 \".concat(isFocusMode?'bg-gray-100':'bg-gray-50'),children:[/*#__PURE__*/_jsx(DistractionStop,{onFocusModeChange:setIsFocusMode}),/*#__PURE__*/_jsx(\"header\",{className:\"bg-white shadow-sm flex-shrink-0 transition-all duration-300 \".concat(isFocusMode?'opacity-70 hover:opacity-100':''),children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto px-4 py-3 flex items-center justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:goBack,className:\"flex items-center gap-2 text-blue-600 hover:text-blue-700 transition-colors\",children:[/*#__PURE__*/_jsx(FiArrowLeft,{size:20}),\" Back\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center\",children:/*#__PURE__*/_jsx(FiCpu,{className:\"text-white\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"h1\",{className:\"text-lg font-bold text-gray-900\",children:[courseName,\" Assistant\"]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500\",children:\"AI-powered learning companion\"})]})]})]})})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-y-auto\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto px-4 py-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-4\",children:/*#__PURE__*/_jsx(APIStatusIndicator,{})}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[messages.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center h-full min-h-[400px] text-center animate-fade-in\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 h-20 bg-gradient-to-br from-blue-100 to-purple-100 rounded-2xl flex items-center justify-center mb-6\",children:/*#__PURE__*/_jsx(FiCpu,{className:\"text-4xl text-blue-600\"})}),/*#__PURE__*/_jsxs(\"h2\",{className:\"text-2xl font-bold text-gray-900 mb-3\",children:[\"Start Learning \",courseName,\"!\"]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-gray-600 max-w-md mb-8\",children:[\"Ask any question about \",courseName,\" and I'll help you understand it with personalized explanations.\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-wrap gap-2 justify-center max-w-lg\",children:[\"What is \".concat(courseName,\"?\"),'Explain with examples','Best practices','Common mistakes'].map((prompt,idx)=>/*#__PURE__*/_jsx(\"button\",{onClick:()=>setInput(prompt),className:\"px-4 py-2 bg-white border border-gray-200 rounded-full text-sm text-gray-700 hover:bg-blue-50 hover:border-blue-300 hover:text-blue-600 transition-all\",children:prompt},idx))})]}):messages.map((msg,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4 animate-fade-in\",style:{animationDelay:\"\".concat(idx*50,\"ms\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-gradient-to-br from-blue-600 to-blue-700 text-white rounded-2xl rounded-br-md px-4 py-3 max-w-[80%] shadow-sm\",children:msg.userMessage})}),/*#__PURE__*/_jsx(AIResponseBox,{content:msg.aiResponse})]},msg.id)),loading&&/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-start animate-fade-in\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex gap-3 items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 bg-gradient-to-br from-purple-100 to-blue-100 rounded-lg flex items-center justify-center flex-shrink-0\",children:/*#__PURE__*/_jsx(FiCpu,{className:\"text-purple-600\",size:16})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border border-gray-100 rounded-2xl px-4 py-2 shadow-sm\",children:/*#__PURE__*/_jsx(TypingIndicator,{})})]})}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white border-t border-gray-200 flex-shrink-0\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-4xl mx-auto px-4 py-4\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSendMessage,className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{ref:inputRef,type:\"text\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:handleKeyDown,placeholder:\"Ask a question...\",className:\"flex-1 px-4 py-3 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all\",disabled:loading}),/*#__PURE__*/_jsxs(\"button\",{type:\"submit\",disabled:loading||!input.trim(),className:\"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-700 hover:to-purple-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2 font-medium shadow-sm\",children:[loading?/*#__PURE__*/_jsx(\"div\",{className:\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\"}):/*#__PURE__*/_jsx(FiSend,{}),\"Send\"]})]})})}),/*#__PURE__*/_jsx(FocusTimer,{totalTime:focusTimer.totalTime,activeTime:focusTimer.activeTime,focusScore:focusTimer.focusScore,isActive:focusTimer.isActive})]});});export default ChatPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}